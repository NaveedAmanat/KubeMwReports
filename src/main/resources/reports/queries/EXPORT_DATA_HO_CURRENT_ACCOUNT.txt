SELECT  MR.REG_NM, MA.AREA_NM, MB.BRNCH_NM,
         GET_CLNT_SEQ (MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ)  CLNT_SEQ,
         TO_CHAR(MJH.JV_DT, 'dd-MM-yyyy') JV_DATE,
         (CASE WHEN INITCAP (MJH.ENTY_TYP) = 'Expense' THEN GET_EXP_LEDGER(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ)
               --when initcap (mjh.enty_typ) = 'Disbursement' then get_disb_prd(mjh.enty_seq, mjh.enty_typ, mjh.brnch_seq)
               ELSE INITCAP (MJH.ENTY_TYP)
          END) LEDGER_HEAD,
        (CASE WHEN MJH.PRNT_VCHR_REF IS NOT NULL THEN 'Reversal JV' 
         ELSE GET_VOUCHER_TYPE(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ) END) JV_TYPE,
        MJH.JV_HDR_SEQ JV_HEADER_SEQ,
        MJH.ENTY_SEQ JV_REF_SEQ,
    NVL(SUM(NVL((CASE WHEN MJD.CRDT_DBT_FLG = 1 THEN NVL(MJD.AMT,0) END),0)),0) DEBIT,  
    NVL(SUM(NVL((CASE WHEN MJD.CRDT_DBT_FLG = 0 THEN NVL(MJD.AMT,0) END),0)),0) CREDIT,
    GET_INSTR_NUM(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ) INSTRUMENT_NO, 
    MJH.JV_DSCR JV_NARRATION,
    GET_STR_TYP(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ) JV_TRANS_LOCATION    
    FROM MW_JV_HDR MJH, MW_JV_DTL MJD, MW_BRNCH MB, MW_AREA MA, MW_REG MR  
    WHERE MJH.JV_HDR_SEQ = MJD.JV_HDR_SEQ  
    AND MJH.BRNCH_SEQ = MB.BRNCH_SEQ AND MB.CRNT_REC_FLG = 1
    AND MB.AREA_SEQ = MA.AREA_SEQ AND MA.CRNT_REC_FLG = 1
    AND MA.REG_SEQ = MR.REG_SEQ AND MR.CRNT_REC_FLG = 1
    --and mjh.brnch_seq in (8)
    --and mjd.gl_acct_num = 'SDFSF'
    --and mjh.JV_HDR_SEQ = 13032406
    AND MJD.GL_ACCT_NUM IN (SELECT GL_ACCT_NUM FROM MW_TYPS MT WHERE MT.TYP_STR = 'HEAD OFFICE CURRENT ACCOUNT' AND MT.TYP_CTGRY_KEY = 2 AND MT.BRNCH_SEQ = MJH.BRNCH_SEQ AND MT.CRNT_REC_FLG=1)
    --AND TO_DATE(MJH.JV_DT)  BETWEEN TO_DATE('01-JUL-2020') AND TO_DATE('01-JUL-2020')  
    
    AND TO_DATE(MJH.JV_DT)  BETWEEN :P_DATE_FROM AND :P_DATE_TO 
    
    GROUP BY TO_CHAR(MJH.JV_DT, 'dd-MM-yyyy'),
             GET_CLNT_SEQ (MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ),  
             MJH.PRNT_VCHR_REF,  
             INITCAP (MJH.ENTY_TYP) , MJH.JV_HDR_SEQ ,MJH.ENTY_SEQ,               
            GET_STR_TYP(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ)  ,
             MJH.JV_DSCR,MR.REG_NM, MA.AREA_NM, MB.BRNCH_NM,
             GET_EXP_LEDGER(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ),
             GET_DISB_PRD(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ),
             GET_VOUCHER_TYPE(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ),
             GET_INSTR_NUM(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ), MJD.GL_ACCT_NUM
