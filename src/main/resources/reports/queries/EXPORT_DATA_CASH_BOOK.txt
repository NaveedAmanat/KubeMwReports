SELECT MR.REG_NM, MA.AREA_NM, MB.BRNCH_NM, 
         TO_CHAR(MJH.JV_DT, 'dd-MM-yyyy') JV_DATE,
         (CASE WHEN INITCAP (MJH.ENTY_TYP) = 'Expense' THEN GET_EXP_LEDGER(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ)
               WHEN INITCAP (MJH.ENTY_TYP) = 'Disbursement' THEN GET_DISB_PRD(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ)
               ELSE INITCAP (MJH.ENTY_TYP)
          END) LEDGER_HEAD, 
         GET_CLNT_SEQ (MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ)  CLNT_SEQ,         
         MJH.JV_HDR_SEQ JV_HEADER_SEQ,
         MJH.ENTY_SEQ JV_REF_SEQ,
         GET_INSTR_NUM(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ) INSTRUMENT_NO,  
         NVL(SUM(NVL((CASE WHEN MJD.CRDT_DBT_FLG = 1 THEN NVL(MJD.AMT,0) END),0)),0) RECIEPT,    
         NVL(SUM(NVL((CASE WHEN MJD.CRDT_DBT_FLG = 0 THEN NVL(MJD.AMT,0) END),0)),0) PAYMENT, 
         (CASE WHEN MJH.PRNT_VCHR_REF IS NOT NULL THEN 'Reversal JV' 
         ELSE GET_VOUCHER_TYPE(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ) END) JV_TYPE,       
         (CASE WHEN INITCAP (MJH.ENTY_TYP) = 'Expense' THEN GET_EXP_TYP(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ)                
          ELSE MJH.JV_DSCR END) JV_NARRATION
FROM MW_JV_HDR MJH, MW_JV_DTL MJD, MW_BRNCH MB, MW_AREA MA, MW_REG MR     
WHERE MJH.JV_HDR_SEQ = MJD.JV_HDR_SEQ   
AND MJH.BRNCH_SEQ = MB.BRNCH_SEQ AND MB.CRNT_REC_FLG = 1
    AND MB.AREA_SEQ = MA.AREA_SEQ AND MA.CRNT_REC_FLG = 1
    AND MA.REG_SEQ = MR.REG_SEQ AND MR.CRNT_REC_FLG = 1
    --and mjh.brnch_seq in (24)
AND MJD.GL_ACCT_NUM = (SELECT T.GL_ACCT_NUM 
                      FROM MW_TYPS T WHERE T.CRNT_REC_FLG =  1 
                      AND T.TYP_ID ='0001' AND T.TYP_CTGRY_KEY=3
                      AND T.BRNCH_SEQ=0 )     
--AND TO_DATE(MJH.JV_DT) BETWEEN TO_DATE('01-Mar-2021') AND TO_DATE('31-Mar-2021')  

AND TO_DATE(MJH.JV_DT) BETWEEN :P_DATE_FROM AND :P_DATE_TO 

GROUP BY MR.REG_NM, MA.AREA_NM, MB.BRNCH_NM, TO_CHAR(MJH.JV_DT, 'dd-MM-yyyy'), MJH.PRNT_VCHR_REF, MJH.JV_DSCR,
GET_CLNT_SEQ (MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ),MJH.ENTY_SEQ, MJH.BRNCH_SEQ,
GET_INSTR_NUM(MJH.ENTY_SEQ, MJH.ENTY_TYP, MJH.BRNCH_SEQ),MJH.ENTY_TYP,MJH.JV_HDR_SEQ
